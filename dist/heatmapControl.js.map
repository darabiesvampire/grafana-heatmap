{"version":3,"sources":["../src/heatmapControl.js"],"names":["getColorForValue","data","value","console","info","debug","i","thresholds","length","colorMap","_","first","TimeSeries","kbn","MetricsPanelCtrl","heatmapEditor","displayEditor","System","config","meta","format","import","panelDefaults","seriesOverrides","colors","legend","show","min","max","avg","current","total","gradient","enabled","maxDataPoints","mappingType","nullPointMode","valueName","valueOptions","valueMaps","op","text","content","init","startOnLoad","logLevel","cloneCssStyles","htmlLabels","useMaxWidth","diagramMarginX","diagramMarginY","actorMargin","width","height","boxMargin","boxTextMargin","noteMargin","messageMargin","mirrorActors","bottomMarginAdj","titleTopMargin","barHeight","barGap","topPadding","leftPadding","gridLineStartPadding","fontSize","fontFamily","numberSectionStyles","HeatmapCtrl","$scope","$injector","$sce","defaults","panel","chartId","id","containerDivId","events","on","onInitEditMode","bind","onDataReceived","initializePanel","err","hash","getPanelContainer","html","addEditorTab","$","document","getElementById","dataList","series","map","seriesHandler","setValues","render","seriesData","datapoints","alias","target","replace","flotpairs","getFlotPairs","override","push","without","thresholdCount","colorCount","refresh","colorIndex","color","splice","graphId","remove","seriesItem","applyOverrides","lastPoint","last","lastValue","isArray","valueRounded","valueFormated","isString","escape","stats","decimalInfo","getDecimalsForValue","formatFunc","valueFormats","valueFormatted","decimals","scaledDecimals","roundValue","getGradientForValue","colorData","Math","apply","absoluteDistance","valueDistanceFromMin","xPercent","getColorByXPercentage","canvas","seriesItemAlias","overrides","split","strVale","Number","trim","reverse","isNumber","delta","dec","floor","log","LN10","magn","pow","norm","size","result","scope","elem","attrs","ctrl","chartElement","find","append","chartContainer","css","updateChart","d3plus","viz","container","type","draw","renderingCompleted","templateUrl"],"mappings":"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","file":"heatmapControl.js","sourcesContent":["import './libs/d3/d3'; \r\nimport TimeSeries from 'app/core/time_series2';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport {MetricsPanelCtrl} from 'app/plugins/sdk';\r\nimport {heatmapEditor, displayEditor} from './properties';\r\nimport _ from 'lodash';\r\nimport './series_overrides_heatmap_ctrl';\r\nimport './css/heatmap.css!'\r\n\r\nSystem.config({\r\n\t  meta: {\r\n\t    'plugins/savantly-heatmap-panel/libs/d3plus/d3plus.full.js': {\r\n\t      format: 'global'\r\n\t    }\r\n\t  }\r\n\t});\r\n\r\nSystem.import('plugins/savantly-heatmap-panel/libs/d3plus/d3plus.full.js');\r\n\r\nconst panelDefaults = {\r\n\t// other style overrides\r\n    seriesOverrides: [],\r\n\tthresholds: '0,10',\r\n\tcolors: ['rgba(50, 172, 45, 0.97)', 'rgba(237, 129, 40, 0.89)', 'rgba(245, 54, 54, 0.9)'],\r\n\tlegend: {\r\n\t\tshow: true,\r\n\t\tmin: true,\r\n\t\tmax: true,\r\n\t\tavg: true,\r\n\t\tcurrent: true,\r\n\t\ttotal: true,\r\n\t\tgradient: {\r\n\t\t\tenabled: true,\r\n\t\t\tshow: true\r\n\t\t}\r\n\t},\r\n\tmaxDataPoints: 100,\r\n\tmappingType: 1,\r\n\tnullPointMode: 'connected',\r\n\tformat: 'none',\r\n\tvalueName: 'avg',\r\n\tvalueOptions: ['avg', 'min', 'max', 'total', 'current'],\r\n    valueMaps: [\r\n      { value: 'null', op: '=', text: 'N/A' }\r\n    ],\r\n    content: 'graph LR\\n' +\r\n\t\t'A[Square Rect] -- Link text --> B((Circle))\\n' +\r\n\t\t'A --> C(Round Rect)\\n' +\r\n\t\t'B --> D{Rhombus}\\n' +\r\n\t\t'C --> D\\n',\r\n\tinit: {\r\n\t\tstartOnLoad: false,\r\n\t\tlogLevel: 2, //1:debug, 2:info, 3:warn, 4:error, 5:fatal\r\n    \tcloneCssStyles: false, // - This options controls whether or not the css rules should be copied into the generated svg\r\n\t\tstartOnLoad: false, // - This options controls whether or mermaid starts when the page loads\r\n\t\tarrowMarkerAbsolute: true, // - This options controls whether or arrow markers in html code will be absolute paths or an anchor, #. This matters if you are using base tag settings.\r\n\t\tflowchart: {\r\n\t\t\thtmlLabels: true,\r\n\t\t\tuseMaxWidth: true\r\n\t\t},\r\n\t\tsequenceDiagram: {\r\n\t\t\tdiagramMarginX: 50, // - margin to the right and left of the sequence diagram\r\n\t\t\tdiagramMarginY: 10, // - margin to the over and under the sequence diagram\r\n\t\t\tactorMargin: 50, // - Margin between actors\r\n\t\t\twidth: 150, // - Width of actor boxes\r\n\t\t\theight: 65, // - Height of actor boxes00000000001111\r\n\t\t\tboxMargin: 10, // - Margin around l01oop boxes\r\n\t\t\tboxTextMargin: 5, // - margin around the text in loop/alt/opt boxes\r\n\t\t\tnoteMargin: 10, // - margin around notes\r\n\t\t\tmessageMargin: 35, // - Space between messages\r\n\t\t\tmirrorActors: true, // - mirror actors under diagram\r\n\t\t\tbottomMarginAdj: 1, // - Depending on css styling this might need adjustment. Prolongs the edge of the diagram downwards\r\n\t\t\tuseMaxWidth: true, // - when this flag is set the height and width is set to 100% and is then scaling with the available space if not the absolute space required is used\r\n\t\t},\r\n\t\tgantt: {\r\n\t\t\ttitleTopMargin: 25, // - margin top for the text over the gantt diagram\r\n\t\t\tbarHeight: 20, // - the height of the bars in the graph\r\n\t\t\tbarGap: 4, // - the margin between the different activities in the gantt diagram\r\n\t\t\ttopPadding: 50, // - margin between title and gantt diagram and between axis and gantt diagram.\r\n\t\t\tleftPadding: 75, // - the space allocated for the section name to the left of the activities.\r\n\t\t\tgridLineStartPadding: 35, // - Vertical starting position of the grid lines\r\n\t\t\tfontSize: 11, // - font size ...\r\n\t\t\tfontFamily: '\"Open-Sans\", \"sans-serif\"', // - font family ...\r\n\t\t\tnumberSectionStyles: 3, // - the number of alternating section styles\r\n\t\t\t/** axisFormatter: // - formatting of the axis, this might need adjustment to match your locale and preferences\r\n\t\t\t\t[\r\n\t\t        // Within a day\r\n\t\t        ['%I:%M', function (d) {\r\n\t\t            return d.getHours();\r\n\t\t        }],\r\n\t\t        // Monday a week\r\n\t\t        ['w. %U', function (d) {\r\n\t\t            return d.getDay() == 1;\r\n\t\t        }],\r\n\t\t        // Day within a week (not monday)\r\n\t\t        ['%a %d', function (d) {\r\n\t\t            return d.getDay() && d.getDate() != 1;\r\n\t\t        }],\r\n\t\t        // within a month\r\n\t\t        ['%b %d', function (d) {\r\n\t\t            return d.getDate() != 1;\r\n\t\t        }],\r\n\t\t        // Month\r\n\t\t        ['%m-%y', function (d) {\r\n\t\t            return d.getMonth();\r\n\t\t        }]] **/\r\n\t\t},\r\n\t\t//classDiagram: {},\r\n    \t//info: {}\r\n\t}\r\n};\r\n\r\nclass HeatmapCtrl extends MetricsPanelCtrl {\r\n\tconstructor($scope, $injector, $sce) {\r\n\t\tsuper($scope, $injector);\r\n\t\t_.defaults(this.panel, panelDefaults);\r\n\t\t\r\n\t\tthis.panel.chartId = 'chart_' + this.panel.id;\r\n\t\tthis.containerDivId = 'container_'+this.panel.chartId;\r\n\t\tthis.$sce = $sce;\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n\t\tthis.initializePanel();\r\n\t}\r\n\t\r\n\tinitializePanel(){\r\n\t}\r\n\t\r\n\thandleParseError(err, hash){\r\n\t\tthis.getPanelContainer().html('<p>Error:</p><pre>' + err + '</pre>');\r\n\t}\r\n\t\r\n\tonInitEditMode() {\r\n\t\tthis.addEditorTab('Heatmap', heatmapEditor, 2);\r\n\t\tthis.addEditorTab('Display', displayEditor, 3);\r\n\t}\r\n\t\r\n\tgetPanelContainer(){\r\n\t\treturn $(document.getElementById(this.containerDivId));\r\n\t}\r\n\t\r\n\tonDataReceived(dataList){\r\n\t\tconsole.info('received data');\r\n\t\tconsole.debug(dataList);\r\n\t\tthis.series = dataList.map(this.seriesHandler.bind(this));\r\n\t\tconsole.info('mapped dataList to series');\r\n\t\tconsole.debug(this.series);\r\n\r\n\t\tvar data = {};\r\n\t\tthis.setValues(data);\r\n\t\t\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tseriesHandler(seriesData) {\r\n\t\tvar series = new TimeSeries({\r\n\t\t\tdatapoints: seriesData.datapoints,\r\n\t\t\talias: seriesData.target.replace(/\"|,|;|=|:|{|}/g, '_')\r\n\t\t});\r\n\t    series.flotpairs = series.getFlotPairs(this.panel.nullPointMode);\r\n\t    return series;\r\n\t} // End seriesHandler()\r\n\t\r\n\taddSeriesOverride(override) {\r\n\t\tthis.panel.seriesOverrides.push(override || {});\r\n\t}\r\n\r\n\tremoveSeriesOverride(override) {\r\n\t\tthis.panel.seriesOverrides = _.without(this.panel.seriesOverrides, override);\r\n\t    this.render();\r\n\t}\r\n\t\r\n\tupdateThresholds(){\r\n\t\tvar thresholdCount = this.panel.thresholds.length;\r\n\t\tvar colorCount = this.panel.colors.length;\r\n\t\tthis.refresh();\r\n\t}\r\n\t\r\n\tchangeColor(colorIndex, color){\r\n\t\tthis.panel.colors[colorIndex] = color;\r\n\t}\r\n\t\r\n\tremoveColor(colorIndex){\r\n\t\tthis.panel.colors.splice(colorIndex,1);\r\n\t}\r\n\t\r\n\taddColor(){\r\n\t\tthis.panel.colors.push('rgba(255, 255, 255, 1)');\r\n\t}\r\n\t\r\n\tclearPanel(){\r\n\t\t$('#'+this.panel.graphId).remove();\r\n\t}\r\n\t\r\n\tsetValues(data) {\r\n\t    if (this.series && this.series.length > 0) {\r\n\t\t\tfor(var i = 0; i < this.series.length; i++){\r\n\t\t\t\tvar seriesItem = this.series[i];\r\n\t\t\t\tconsole.debug('setting values for series');\r\n\t\t\t\tconsole.debug(seriesItem);\r\n\t\t\t\tdata[seriesItem.alias] = this.applyOverrides(seriesItem.alias);\r\n\t\t\t\tvar lastPoint = _.last(seriesItem.datapoints);\r\n\t\t\t    var lastValue = _.isArray(lastPoint) ? lastPoint[0] : null;\r\n\t\t\t\r\n\t\t\t\tif (this.panel.valueName === 'name') {\r\n\t\t\t\t\tdata[seriesItem.alias].value = 0;\r\n\t\t\t        data[seriesItem.alias].valueRounded = 0;\r\n\t\t\t        data[seriesItem.alias].valueFormated = seriesItem.alias;\r\n\t\t\t\t} else if (_.isString(lastValue)) {\r\n\t\t\t        data[seriesItem.alias].value = 0;\r\n\t\t\t        data[seriesItem.alias].valueFormated = _.escape(lastValue);\r\n\t\t\t        data[seriesItem.alias].valueRounded = 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata[seriesItem.alias].value = seriesItem.stats[data[seriesItem.alias].valueName];\r\n\t\t\t        //data[seriesItem.alias].flotpairs = seriesItem.flotpairs;\r\n\t\t\t\r\n\t\t\t        var decimalInfo = this.getDecimalsForValue(data[seriesItem.alias].value);\r\n\t\t\t        var formatFunc = kbn.valueFormats[this.panel.format];\r\n\t\t\t        data[seriesItem.alias].valueFormatted = formatFunc(data[seriesItem.alias].value, decimalInfo.decimals, decimalInfo.scaledDecimals);\r\n\t\t\t        data[seriesItem.alias].valueRounded = kbn.roundValue(data[seriesItem.alias].value, decimalInfo.decimals);\r\n\t\t\t\t}\r\n\t\t\t\tif (this.panel.legend.gradient.enabled){\r\n\t\t\t\t\tdata[seriesItem.alias].color = this.getGradientForValue(data[seriesItem.alias].colorData, data[seriesItem.alias].value);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdata[seriesItem.alias].color = getColorForValue(data[seriesItem.alias].colorData, data[seriesItem.alias].value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t    }\r\n\t} // End setValues()\r\n\t\r\n\tgetGradientForValue(data, value){\r\n\t\tconsole.info('Getting gradient for value');\r\n\t\tconsole.debug(data);\r\n\t\tconsole.debug(value);\r\n\t\tvar min = Math.min.apply(Math, data.thresholds);\r\n\t\tvar max = Math.max.apply(Math, data.thresholds);\r\n\t\tvar absoluteDistance = max - min;\r\n\t\tvar valueDistanceFromMin = value - min;\r\n\t\tvar xPercent = valueDistanceFromMin/absoluteDistance;\r\n\t\t// Get the smaller number to clamp at 0.99 max\r\n\t\txPercent = Math.min(0.99, xPercent);\r\n\t\t// Get the larger number to clamp at 0.01 min\r\n\t\txPercent = Math.max(0.01, xPercent);\r\n\t\t\r\n\t\treturn getColorByXPercentage(this.canvas, xPercent);\r\n\t}\r\n\t\r\n\tapplyOverrides(seriesItemAlias){\r\n\t\tvar seriesItem = {}, colorData = {}, overrides = {};\r\n\t\tconsole.info('applying overrides for seriesItem');\r\n\t\tconsole.debug(seriesItemAlias);\r\n\t\tconsole.debug(this.panel.seriesOverrides);\r\n\t\tfor(var i=0; i<=this.panel.seriesOverrides.length; i++){\r\n\t\t\tconsole.debug('comparing:');\r\n\t\t\tconsole.debug(this.panel.seriesOverrides[i]);\r\n\t\t\tif (this.panel.seriesOverrides[i] && this.panel.seriesOverrides[i].alias == seriesItemAlias){\r\n\t\t\t\toverrides = this.panel.seriesOverrides[i];\r\n\t\t\t}\r\n\t\t}\r\n\t\tcolorData.thresholds = (overrides.thresholds || this.panel.thresholds).split(',').map(function(strVale) {\r\n\t\t\treturn Number(strVale.trim());\r\n\t\t});\r\n\t\tcolorData.colorMap = this.panel.colors;\r\n\t\tseriesItem.colorData = colorData;\r\n\t\t\r\n\t\tseriesItem.valueName = overrides.valueName || this.panel.valueName;\r\n\t\t\r\n\t\treturn seriesItem;\r\n\t}\r\n\t\r\n\tinvertColorOrder() {\r\n\t    this.panel.colors.reverse();\r\n\t    this.refresh();\r\n\t}\r\n\r\n\tgetDecimalsForValue(value) {\r\n\t    if (_.isNumber(this.panel.decimals)) {\r\n\t      return {decimals: this.panel.decimals, scaledDecimals: null};\r\n\t    }\r\n\r\n\t    var delta = value / 2;\r\n\t    var dec = -Math.floor(Math.log(delta) / Math.LN10);\r\n\t\r\n\t    var magn = Math.pow(10, -dec),\r\n\t      norm = delta / magn, // norm is between 1.0 and 10.0\r\n\t      size;\r\n\t\r\n\t    if (norm < 1.5) {\r\n\t      size = 1;\r\n\t    } else if (norm < 3) {\r\n\t      size = 2;\r\n\t      // special case for 2.5, requires an extra decimal\r\n\t      if (norm > 2.25) {\r\n\t        size = 2.5;\r\n\t        ++dec;\r\n\t      }\r\n\t    } else if (norm < 7.5) {\r\n\t      size = 5;\r\n\t    } else {\r\n\t      size = 10;\r\n\t    }\r\n\t\r\n\t    size *= magn;\r\n\t\r\n\t    // reduce starting decimals if not needed\r\n\t    if (Math.floor(value) === value) { dec = 0; }\r\n\t\r\n\t    var result = {};\r\n\t    result.decimals = Math.max(0, dec);\r\n\t    result.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\r\n\t\r\n\t    return result;\r\n\t}\r\n\t\r\n\tlink(scope, elem, attrs, ctrl) {\r\n\t\tvar chartElement = elem.find('.heatmap');\r\n\t\tchartElement.append('<div id=\"'+ctrl.containerDivId+'\"></div>');\r\n\t    var chartContainer = $(document.getElementById(ctrl.containerDivId));\r\n    \tconsole.debug('found chartContainer');\r\n    \tconsole.debug(chartContainer);\r\n    \telem.css('height', ctrl.height + 'px');\r\n    \t\r\n\r\n    \tfunction render(){\r\n    \t\tupdateChart();\r\n    \t}\r\n    \t\r\n    \tfunction updateChart(){\r\n    \t\tvar data = [{\"value\": 100, \"name\": \"alpha\"},\r\n    \t\t            {\"value\": 70, \"name\": \"beta\"}];\r\n    \t\t\r\n    \t\td3plus.viz()\r\n    \t\t\t.container(\"#\"+ctrl.containerDivId)\r\n    \t\t\t.data(data)\r\n    \t\t\t.type(\"tree_map\")\r\n    \t\t\t.id(\"name\")\r\n    \t\t\t.size(\"value\")\r\n    \t\t\t.draw();\r\n    \t}\r\n    \t\r\n    \tthis.events.on('render', function() {\r\n\t\t\trender();\r\n\t\t\tctrl.renderingCompleted();\r\n\t    });\r\n\t    \r\n\t}\r\n// End Class\r\n}\r\n\r\nfunction getColorForValue(data, value) {\r\n\tconsole.info('Getting color for value');\r\n\tconsole.debug(data);\r\n\tconsole.debug(value);\r\n\tfor (var i = data.thresholds.length; i > 0; i--) {\r\n\t\tif (value >= data.thresholds[i-1]) {\r\n\t\treturn data.colorMap[i];\r\n\t}\r\n  }\r\n  return _.first(data.colorMap);\r\n}\r\n\r\nHeatmapCtrl.templateUrl = 'module.html';\r\n\r\nexport {\r\n\tHeatmapCtrl,\r\n\tHeatmapCtrl as MetricsPanelCtrl\r\n};"]}